var Modularity=Modularity||{};!function(t){t('input[type="checkbox"].sidebar-area-activator').on("click",function(i){var e=t(this).is(":checked"),o=t(this).attr("value");i.shiftKey&&(e?t('input.sidebar-area-activator[type="checkbox"][value="'+o+'"]').attr("checked",!0):t('input.sidebar-area-activator[type="checkbox"][value="'+o+'"]').attr("checked",!1))})}(jQuery),function(t){t("#modularity-options #publish").on("click",function(){t(this).siblings(".spinner").css("visibility","visible")}),t('a.wp-first-item[href="admin.php?page=modularity"]').parent("li").remove(),t("#modularity-tabs a").on("click",function(i){return wp.autosave&&(t(window).unbind(),wp.autosave.server.triggerSave(),t(document).ajaxComplete(function(){return!0})),!0})}(jQuery),jQuery(document).ready(function(t){if(t("#modularity-mb-modules").length){var i=t("#modularity-mb-modules").offset();t(document).scroll(function(){t(window).scrollTop()+50>i.top&&!t("#modularity-mb-modules").hasClass("is-fixed")?t("#modularity-mb-modules").addClass("is-fixed"):t(window).scrollTop()+50<i.top&&t("#modularity-mb-modules").hasClass("is-fixed")&&t("#modularity-mb-modules").removeClass("is-fixed")})}t(".modularity-edit-module a").on("click",function(i){i.preventDefault(),Modularity.Editor.Thickbox.postAction="edit-inline-not-saved",Modularity.Prompt.Modal.open(t(i.target).closest("a").attr("href"))})}),jQuery(document).ready(function(t){t(".frontend-filter").hide(),"post"!==t("#modularity-latest-post-type select").val()&&"post"!==t("#modularity-latest-post-type select").val()||t(".frontend-filter").show(),t("body").on("change","#modularity-latest-post-type select",function(){"post"===t("#modularity-latest-post-type select").val()||"page"===t("#modularity-latest-post-type select").val()?t(".frontend-filter").show():t(".frontend-filter").hide()}).trigger("change")}),Modularity=Modularity||{},Modularity.Editor=Modularity.Editor||{},Modularity.Editor.Autosave=function(t){function i(){t(function(){}.bind(this))}return i.prototype.save=function(i){t("#modularity-options #publishing-action .spinner").css("visibility","visible");var e=t(i).serializeObject();e.id=modularity_post_id,e.action="save_modules",t.post(ajaxurl,e,function(i){t("#modularity-options #publishing-action .spinner").css("visibility","hidden")})},new i}(jQuery),Modularity=Modularity||{},Modularity.Editor=Modularity.Editor||{},Modularity.Editor.DragAndDrop=function(t){function i(){t(function(){"undefined"!=typeof pagenow&&"admin_page_modularity-editor"==pagenow&&this.init()}.bind(this))}return i.prototype.init=function(){this.setupDraggable(),this.setupDroppable(),this.setupSortable()},i.prototype.setupSortable=function(){t(".modularity-js-sortable").sortable({handle:".modularity-sortable-handle",connectWith:".modularity-js-sortable",placeholder:"ui-sortable-placeholder",start:function(t,i){try{var e=jQuery(i.item).attr("data-sidebar-incompability");e=JSON.parse(e),e&&"object"==typeof e&&jQuery(".modularity-sidebar-area").each(function(t,i){e.includes(jQuery(this).attr("data-area-id"))?jQuery(this).parent().parent().addClass("modularity-incompatible-area"):jQuery(this).parent().parent().removeClass("modularity-incompatible-area")})}catch(o){console.log("Incompability information not defined - "+o)}},stop:function(i,e){var o=e.item.parents("ul").data("area-id");e.item.find('input[name^="modularity_modules"]').each(function(i,e){var a=t(this).attr("name").replace(/\[(.*?)\]/i,"["+o+"]");t(this).attr("name",a)}),jQuery("[id^=modularity-mb-]").removeClass("modularity-incompatible-area")}}).bind(this)},i.prototype.setupDraggable=function(){t(".modularity-js-draggable").draggable({appendTo:"body",containment:"document",scroll:!1,helper:"clone",revert:"invalid",revertDuration:200,start:function(t,i){try{var e=jQuery(this).attr("data-sidebar-incompability");e=JSON.parse(e),e&&"object"==typeof e&&jQuery(".modularity-sidebar-area").each(function(t,i){e.includes(jQuery(this).attr("data-area-id"))?jQuery(this).parent().parent().addClass("modularity-incompatible-area"):jQuery(this).parent().parent().removeClass("modularity-incompatible-area")})}catch(o){console.log("Incompability information not defined - "+o)}},stop:function(t,i){jQuery("[id^=modularity-mb-]").removeClass("modularity-incompatible-area")}})},i.prototype.setupDroppable=function(){t(".modularity-js-droppable").droppable({accept:".modularity-js-draggable",hoverClass:"modularity-state-droppable",drop:function(t,i){this.appendModule(t,i)}.bind(this)}).bind(this)},i.prototype.appendModule=function(t,i){var e=i.draggable,o=e.find(".modularity-module-name").text(),a=e.data("module-id"),r=e.attr("data-sidebar-incompability");Modularity.Editor.Module.addModule(t.target,a,o,void 0,void 0,void 0,void 0,void 0,r)},new i}(jQuery),Modularity=Modularity||{},Modularity.Editor=Modularity.Editor||{},Modularity.Editor.Module=function(t){function i(){t(function(){"undefined"!=typeof pagenow&&"admin_page_modularity-editor"==pagenow&&(this.handleEvents(),this.loadModules(modularity_post_id))}.bind(this))}var e={is_thickbox:!0},o=!1;return i.prototype.loadModules=function(i){var e={action:"get_post_modules",id:i};t.post(ajaxurl,e,function(i){t.each(i,function(i,e){var o=t('.modularity-sidebar-area[data-area-id="'+i+'"]');t.each(e.modules,function(i,e){"true"==e.hidden&&(e.hidden=!0);var a="undefined"==typeof e.sidebar_incompability||t.isEmptyObject(e.sidebar_incompability)?"":JSON.stringify(e.sidebar_incompability);this.addModule(o,e.post_type,e.post_type_name,e.post_title,e.ID,e.hidden,e.columnWidth,e.isDeprecated,a)}.bind(this)),o.removeClass("modularity-spinner")}.bind(this)),this.initCompleted=!0,t(".modularity-sidebar-area").removeClass("modularity-spinner")}.bind(this),"json")},i.prototype.isEditingModule=function(){return o},i.prototype.getThickBoxUrl=function(i,o){var a="",r={};switch(i){case"add":a="post-new.php";break;case"edit":a="post.php"}return"number"==typeof o.postId&&(r.post=o.postId,r.action="edit"),"string"==typeof o.postType&&(r.post_type=o.postType),admin_url+a+"?"+t.param(r)+"&"+t.param(e)},i.prototype.getImportUrl=function(i){var o="edit.php",a={};return a.post_type=i.postType,admin_url+o+"?"+t.param(a)+"&"+t.param(e)},i.prototype.addModule=function(i,e,o,a,r,d,n,l,u){a="undefined"!=typeof a?": "+a:"",r="undefined"!=typeof r?r:"",n="undefined"!=typeof n?n:"",deprecated=l===!0?'<span class="modularity-deprecated" style="color:#ff0000;">('+modularityAdminLanguage.deprecated+")</span>":"",u="undefined"!=typeof u?u:"";var s=this.getThickBoxUrl("add",{postType:e});Modularity.Editor.Thickbox.postAction="add",r&&(s=this.getThickBoxUrl("edit",{postId:r}),Modularity.Editor.Thickbox.postAction="edit");var p=this.getImportUrl({postType:e}),c="";d===!0&&(c="checked");var m=t(i).data("area-id"),y=Modularity.Helpers.uuid(),h='<li id="post-'+r+'" data-module-id="'+e+'" data-module-stored-width="'+n+"\" data-sidebar-incompability='"+u+'\'>                <span class="modularity-line-wrapper">                    <span class="modularity-sortable-handle"></span>                    <span class="modularity-module-name">                        '+o+"                        "+deprecated+'                        <span class="modularity-module-title">'+a+'</span>                        <label class="modularity-module-hide">                            <input type="hidden" name="modularity_modules['+m+"]["+y+'][hidden]" value="false" />                            <input type="checkbox" name="modularity_modules['+m+"]["+y+'][hidden]" value="true" '+c+" />                            "+modularityAdminLanguage.langhide+'                        </label>                    </span>                    <span class="modularity-module-columns">                        <label>'+modularityAdminLanguage.width+':</label>                        <select name="modularity_modules['+m+"]["+y+'][columnWidth]">                            '+modularityAdminLanguage.widthOptions+'                        </select>                    </span>                    <span class="modularity-module-actions">                        <a href="'+s+'" data-modularity-modal class="modularity-js-thickbox-open"><span>'+modularityAdminLanguage.langedit+'</span></a>                        <a href="'+p+'" class="modularity-js-thickbox-import"><span>'+modularityAdminLanguage.langimport+'</span></a>                        <a href="#remove" class="modularity-module-remove"><span>'+modularityAdminLanguage.langremove+'</span></a>                    </span>                    <input type="hidden" name="modularity_modules['+m+"]["+y+'][postid]" class="modularity-js-module-id" value="'+r+'" required>                </span>            </li>';t(i).append(h),t(".modularity-sidebar-area > li").each(function(i,e){t(".modularity-module-columns select",t(e)).val(t(e).attr("data-module-stored-width"))}),t(".modularity-js-sortable").sortable("refresh")},i.prototype.updateModule=function(t,i){t.find("a.modularity-js-thickbox-open").attr("href",this.getThickBoxUrl("edit",{postId:i.post_id})),t.find("input.modularity-js-module-id").val(i.post_id).change(),t.find(".modularity-module-title").text(": "+i.title)},i.prototype.removeModule=function(t){confirm(modularityAdminLanguage.actionRemove)&&t.remove()},i.prototype.handleEvents=function(){t(document).on("click",".modularity-module-remove",function(i){i.preventDefault();var e=t(i.target).closest("li");this.removeModule(e)}.bind(this)),t(document).on("click",".modularity-js-thickbox-import",function(i){i.preventDefault();t(i.target).closest("a");o=t(i.target).closest("li"),Modularity.Editor.Thickbox.postAction="import",Modularity.Prompt.Modal.open(t(i.target).closest("a").attr("href"))}),t(document).on("click",".modularity-js-thickbox-open",function(i){i.preventDefault();var e=t(i.target).closest("a");e.attr("href").indexOf("post.php")>-1&&(Modularity.Editor.Thickbox.postAction="edit"),o=t(i.target).closest("li"),Modularity.Prompt.Modal.open(t(i.target).closest("a").attr("href"))}.bind(this))},new i}(jQuery),Modularity=Modularity||{},Modularity.Editor=Modularity.Editor||{},Modularity.Editor.Thickbox=function(t){function i(){}return i.prototype.modulePostCreated=function(i){Modularity.Prompt.Modal.close();var e=Modularity.Editor.Module.isEditingModule(),o={action:"get_post",id:i};t.post(ajaxurl,o,function(t){var i={post_id:t.ID,title:t.post_title};Modularity.Editor.Module.updateModule(e,i),Modularity.Editor.Autosave.save("form")},"json")},new i}(jQuery),Modularity=Modularity||{},Modularity.Editor=Modularity.Editor||{},Modularity.Editor.Validate=function(t){function i(){this.handleEvents()}var e=!1,o="validation-error";return i.prototype.run=function(){e=!1,this.checkRequired()},i.prototype.checkRequired=function(){var i=t("[required]");i.removeClass(o),i.each(function(i,a){0===t(a).val().length&&(t(a).parents("li").addClass(o),t(a).one("change",function(i){t(i.target).parents("li").removeClass(o)}),e=!0)}.bind(this))},i.prototype.handleEvents=function(){t(document).on("click","#modularity-mb-editor-publish #publish",function(i){return this.run(),!e||(t("#modularity-mb-editor-publish .spinner").css("visibility","hidden"),!1)}.bind(this))},new i}(jQuery),Modularity=Modularity||{},Modularity.Helpers=Modularity.Helpers||{},Modularity.Helpers=function(t){function i(){t(function(){}.bind(this))}return i.prototype.uuid=function(t){return Math.random().toString(36).substr(2,9)},new i}(jQuery),jQuery.fn.serializeObject=function(){var t={},i=this.serializeArray();return jQuery.each(i,function(){void 0!==t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t},Modularity=Modularity||{},Modularity.Helpers=Modularity.Helpers||{},Modularity.Helpers.Widget=function(t){function i(){t(function(){t(document).on("click",".modularity-js-thickbox-widget-import-widget",function(i){i.preventDefault(),e=t(i.target).parents(".widget-inside");var o=Modularity.Editor.Module.getImportUrl({postType:t(i.target).parents(".widget-inside").find(".modularity-widget-module-type select").val()});Modularity.Editor.Module.editingModule=t(i.target).closest(".widget-inside"),Modularity.Editor.Thickbox.postAction="import-widget",Modularity.Prompt.Modal.open(o)}),t(document).on("click",".modularity-js-thickbox-open-widget",function(i){i.preventDefault();var e=t(i.target).closest("a");e.attr("href").indexOf("post.php")>-1&&(Modularity.Editor.Thickbox.postAction="edit"),editingModule=t(i.target).closest("li"),Modularity.Prompt.Modal.open(t(i.target).closest("a").attr("href"))}.bind(this))}.bind(this))}var e=!1;return i.prototype.isEditingWidget=function(){return e},i.prototype.updateWidget=function(i,e){t(i).find(".modularity-widget-module-id-span").html(e.post_id),t(i).find(".modularity-widget-module-id").val(e.post_id),t(i).find(".modularity-widget-module-edit").attr("href","post.php?post="+e.post_id+"&action=edit&is_thickbox=true").removeClass("hidden"),t(i).find(".modularity-widget-module-title-span").html(e.title),t(i).find(".modularity-widget-module-title").val(e.title)},new i}(jQuery),Modularity=Modularity||{},Modularity.Prompt=Modularity.Prompt||{},Modularity.Prompt.Modal=function(t){function i(){this.handleEvents()}var e=!1;return i.prototype.open=function(i){t("body").addClass("modularity-modal-open").append('            <div id="modularity-modal">                <div class="modularity-modal-wrapper">                    <button class="modularity-modal-close" data-modularity-modal-action="close">&times; '+modularityAdminLanguage.close+'</button>                    <div class="modularity-modal-spinner-container" id="modularity-iframe-loader"><span class="modularity-modal-spinner"></span></div>                    <iframe class="modularity-modal-iframe" src="'+i+'" frameborder="0" onload="document.getElementById(\'modularity-iframe-loader\').style.display=\'none\';" allowtransparency></iframe>                </div>            </div>        '),e=!0},i.prototype.close=function(){t("body").removeClass("modularity-modal-open"),t("#modularity-modal").remove(),e=!1},i.prototype.handleEvents=function(){t(document).on("click",'[data-modularity-modal-action="close"]',function(t){t.preventDefault(),this.close()}.bind(this))},new i}(jQuery);